{"title":"微信小程序使用 canvas 的踩坑记录","slug":"微信小程序页面闪屏","date":"2021-03-23","updated":"2021-03-23","comments":true,"path":"api/posts/64797.json","excerpt":"<p>记录一下微信小程序使用 canvas 踩的坑 </p><p> 微信小程序生成二维码的插件:</p><ol><li><a href=\"https://github.com/demi520/wxapp-qrcode\" target=\"_blank\" rel=\"noopener\" title=\"wxapp-qrcode\">wxapp-qrcode</a></li><li><a href=\"https://github.com/Pudon/weapp-qrcode-base64\" target=\"_blank\" rel=\"noopener\" title=\"weapp-qrcode-base64\">weapp-qrcode-base64</a> 基于 base64 编码输出二维码，不依赖 canvas</li></ol>","cover":null,"covers":null,"content":"<p>记录一下微信小程序使用 canvas 踩的坑 </p><p> 微信小程序生成二维码的插件:</p><ol><li><a href=\"https://github.com/demi520/wxapp-qrcode\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\" title=\"wxapp-qrcode\">wxapp-qrcode</a></li><li><a href=\"https://github.com/Pudon/weapp-qrcode-base64\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\" title=\"weapp-qrcode-base64\">weapp-qrcode-base64</a> 基于 base64 编码输出二维码，不依赖 canvas</li></ol><a id=\"more\"></a><h1 id=\"问题来源\"><a class=\"headerlink\" href=\"# 问题来源\"></a>问题来源 </h1><p> 做一个生成二维码的功能，原来是由前端小程序使用 <a href=\"https://github.com/demi520/wxapp-qrcode\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\" title=\"wxapp-qrcode\">wxapp-qrcode</a> 依赖 canvas 生成二维码。<br>插件使用 canvas 生成临时路径并渲染到 canvas 上，但是由于我把临时路径放在了 image 标签上，把二维码的 canvas 使用 <code>hidden</code> 隐藏了，导致在某些机型上出现了问题。</p><h2 id=\"复现\"><a class=\"headerlink\" href=\"# 复现\"></a>复现 </h2><p> 手机型号：iPhone XS Max<br>系统：iOS 12.0<br>微信版本：8.0.2<br>基础库版本：2.16.0<br>复现结果：渲染内容短暂显示后消失，真机调试二维码部分出现过极短的闪烁，推测可能是 canvas 隐藏后闪烁导致的原因 <br> 复现录屏：</p><p><video src=\"/images/bug.mp4\" controls height=\"600px\"></video></p><h2 id=\"解决方法\"><a class=\"headerlink\" href=\"# 解决方法\"></a>解决方法 </h2><p> 放弃使用 <a href=\"https://github.com/demi520/wxapp-qrcode\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\" title=\"wxapp-qrcode\">wxapp-qrcode</a> 插件，直接由后端生成二维码 url 地址，用 image 标签渲染出来。</p><h1 id=\"总结\"><a class=\"headerlink\" href=\"# 总结\"></a>总结 </h1><p> 使用 canvas 渲染时做隐藏某些机型会出现问题，图片尽量使用 url 地址渲染。</p>","url":"/posts/64797/","min2read":1,"word4post":286,"prev_post":null,"next_post":{"title":"Hexo 主题 Mustom 使用指南（对应主题 1.0 版）","url":"/posts/49651/"},"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" data-id=\"问题来源\" href = \"#\"><span class=\"toc-number\">1.</span> <span class=\"toc-text\">问题来源 </span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" data-id=\"复现\" href = \"#\"><span class=\"toc-number\">1.1.</span> <span class=\"toc-text\">复现 </span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" data-id=\"解决方法\" href = \"#\"><span class=\"toc-number\">1.2.</span> <span class=\"toc-text\">解决方法 </span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" data-id=\"总结\" href = \"#\"><span class=\"toc-number\">2.</span> <span class=\"toc-text\">总结 </span></a></li></ol>","categories":[{"name":"Note","path":"api/categories/Note.json","url":"/categories/Note/"},{"name":"微信小程序","path":"api/categories/微信小程序.json","url":"/categories/Note/微信小程序/"}],"tags":[{"name":"Bug","path":"api/tags/Bug.json","url":"/tags/Bug/"},{"name":"踩坑","path":"api/tags/踩坑.json","url":"/tags/踩坑/"}]}